# Key Architectural Components: Ignition ZK Protocol

## System Overview

The Ignition ZK protocol enables privacy-preserving governance through zero-knowledge proofs, allowing anonymous proposal creation, voting, and fund distribution while ensuring integrity and preventing abuse.

## Core Components

### 1. Identity Management Layer

**MembershipManager Contract**
- **Purpose**: Manages DAO membership and identity verification
- **Key Functions**: 
  - Deploys per-DAO NFT contracts that represent membership
  - Updates DAO's Merkle root
  - Verifies membership proofs
- **Interactions**: Provides membership verification for UI actions

### 2. Proposal Management Layer

**ProposalManager Contract**
- **Purpose**: Handles proposal submission and claim verification
- **Key Functions**:
  - Verifies proposal submission proofs
  - Records proposal submission nullifiers to prevent duplicates
  - Verifies proposal claim proofs
  - Records proposal claim nullifiers to prevent duplicates
  - Enables fund claiming by proposal creators
- **Security Features**: Nullifier tracking, proposal context validation, included membership validation

### 3. Voting System Layer

**VoteManager Contract**
- **Purpose**: Processes votes and enforces governance rules
- **Key Functions**:
  - Verifies vote proofs
  - Prevents double-voting via nullifier tracking
  - Computes vote tallies and quorum requirements
  - Determines proposal outcomes
- **Privacy Features**: Preserves voter anonymity while ensuring vote validity
- **Security Features**: Nullifier tracking, vote context validation, proposal nullifier validation, included membership validation

### 4. Zero-Knowledge Proof Layer

**Verifier Contracts**
- **Purpose**: Validate zero-knowledge proofs generated by users
- **Components**:
  - `MembershipVerifier`: Verifies group membership proofs
  - `ProposalVerifier`: Validates proposal submission proofs (includes membership verification component)
  - `VoteVerifier`: Checks vote validity proofs (includes membership verification component)
  - `ProposalClaimVerifier`: Verifies fund claim proofs
- **Security Considerations**: Protects against invalid proofs, ensures cryptographic integrity

### 5. Governance Control Layer

**GovernanceManager Contract**
- **Purpose**: Coordinates the overall governance process
- **Key Functions**:
  - Owns the Membership, Proposal and Vote Manager contracts
  - Delegates calls to Manager contracts via the relayer
  - Manages protocol parameters and upgrades
  - Controls access to administrative functions
- **Design Principles**: UUPS Upgradeable architecture, role-based access control

### 6. Treasury and Fund Distribution Layer

**TreasuryManager & TreasuryFactory Contracts**
- **Purpose**: Securely manage DAO funds and execute approved disbursements
- **Key Functions**:
  - `TreasuryFactory`: Deploys isolated treasury instances for each DAO or group, ensuring fund segregation and upgradability
  - `TreasuryManager`: Receives and tracks funding requests, approves and executes transfers
  - Stores and enforces timelocks on all outgoing transfers to allow for review and cancellation
  - Allows treasury admins (typically a multisig) to approve, execute, or cancel funding requests
  - Supports emergency locking to halt all transfers if needed
- **Interactions**:
  - Funding modules (e.g., GrantModule) relay approved funding requests to the correct TreasuryManager instance
  - The `GovernanceManager` coordinates fund distribution by delegating calls (e.g., `delegateDistributeGrant`) to the appropriate funding module, which then interacts with the treasury
- **Security Features**: Timelock on transfers, admin-only execution, event logging for all actions, and emergency lock mechanism
- **Design Principles**: Treasuries deployed as upgradeable beacon proxies, role-based access control

## Cross-Component Interaction

1. **ZK Credential Generation Flow**:
   ```
   User → Generate ZK credentials → relayer → GovernanceManager → MembershipManager → Record Merkle Root
   ```

2. **Proposal Creation Flow**:
   ```
   User → Generate ZK Proof → relayer → GovernanceManager → ProposalManager → ProposalVerifier → Record Proposal
   ```

3. **Voting Flow**:
   ```
   User → Generate ZK Proof → relayer → GovernanceManager → VoteManager → VoteVerifier → Record Vote
   ```

4. **Fund Claiming Flow**:
   ```
   User → Generate ZK Proof → relayer → GovernanceManager → ProposalManager → ProposalClaimVerifier → Release Funds
   ```

5. **Fund Rekease Flow**:
  ```
   relayer → GovernanceManager → Funding Module → Treasury instance →  funding request (starts timelock) → Admin approves → Timelock elapses → Admin executes → TreasuryManager sends ETH → Recipient
   ```

## Security Model

- **Privacy Protection**: User identities remain private through ZK proofs
- **Sybil Resistance**: NFT-based membership prevents identity fraud
- **Double-Action Prevention**: Nullifier tracking prevents duplicate actions
- **Integrity Assurance**: Verifier contracts validate all proofs before state changes

This architecture balances privacy, security, and decentralization while enabling complex governance operations with cryptographic guarantees.